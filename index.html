<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Tax Calculator - Multi-Year</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .year-selector {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 860px;
            max-width: 860px;
            transition: width 0.3s ease, max-width 0.3s ease;
        }

        .year-selector h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .year-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .year-btn {
            padding: 12px 24px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #4a5568;
        }

        .year-btn:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .year-btn.active {
            background: #2d3748;
            color: white;
            border-color: #2d3748;
        }

        .scenarios-container {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .scenario-card {
            background: white;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .scenario-control-btn {
            position: absolute;
            top: 15px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #4a5568;
            background: white;
            color: #4a5568;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 10;
        }

        .scenario-control-btn.add-btn {
            right: 15px;
        }

        .scenario-control-btn.remove-btn {
            right: 50px;
        }

        .scenario-control-btn:hover {
            background: #4a5568;
            color: white;
            border-color: #2d3748;
        }

        .scenario-control-btn.hidden {
            display: none;
        }

        .scenario-card:first-child {
            border-radius: 12px 0 0 12px;
            min-width: 800px;
            width: 800px;
            max-width: 800px;
            transition: width 0.3s ease, min-width 0.3s ease, max-width 0.3s ease, border-radius 0.3s ease;
        }

        .scenario-card:first-child:only-child,
        .scenario-card:only-child {
            border-radius: 12px;
        }

        .scenario-card:not(:first-child) {
            border-radius: 0;
            width: 290px;
            padding: 30px 15px;
        }

        .scenario-card:last-child:not(:first-child) {
            border-radius: 0 12px 12px 0;
        }

        .scenario-card.hidden {
            display: none;
        }

        /* CRITICAL: Fixed heights for vertical alignment */
        .residency-section {
            height: 53px; /* Radio buttons + margins */
            margin-bottom: 20px;
        }

        .scenario-header {
            font-size: 1.5em;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            font-weight: 600;
            text-align: center;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scenario-name-input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 1em;
            font-weight: 600;
            color: #2d3748;
            text-align: center;
            outline: none;
            font-family: inherit;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .scenario-name-input:hover {
            background: #f7fafc;
        }

        .scenario-name-input:focus {
            background: #edf2f7;
            border: 1px solid #cbd5e0;
        }

        .scenario-name-input::placeholder {
            color: #2d3748;
            opacity: 1;
        }

        /* Compact scenario styling - hide labels */
        .compact-scenario .residency-section {
            visibility: hidden;
            height: 53px; /* Maintain exact height */
        }
        
        .compact-scenario .scenario-header {
            width: 200px;
            margin-left: auto;
            margin-right: auto;
        }

        .compact-scenario .scenario-name-input {
            width: 200px;
        }

        .compact-scenario .form-group label,
        .compact-scenario .form-group-inline > label:first-child,
        .compact-scenario .form-group-inline > label,
        .compact-scenario .checkbox-option label,
        .compact-scenario label {
            display: none !important;
        }

        /* All input rows must have consistent height */
        .form-group-inline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #e2e8f0;
            min-height: 50px;
        }

        .compact-scenario .form-group-inline {
            justify-content: flex-end;
        }

        .form-group-inline.no-border {
            border-bottom: none;
            padding-bottom: 3px;
        }

        .form-group-inline.no-border + .form-group-inline {
            padding-top: 3px;
        }

        /* Checkbox sections - fixed height */
        .checkbox-section {
            min-height: 40px;
            margin-bottom: 8px;
            margin-top: 8px;
            display: flex;
            align-items: center;
        }

        .compact-scenario .checkbox-section {
            justify-content: flex-end;
            min-height: 40px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
            line-height: 1;
        }

        .compact-scenario .checkbox-option {
            justify-content: flex-end;
        }

        .compact-scenario .checkbox-option label {
            display: none !important;
        }

        /* Dividend inputs - maintain space even when hidden */
        .dividend-inputs {
            margin-bottom: 0px;
            min-height: 0;
            overflow: hidden;
            transition: min-height 0.3s;
        }

        .dividend-inputs.hidden {
            display: none;
        }

        .dividend-inputs .form-group-inline {
            min-height: 50px;
        }

        .compact-scenario .dividend-inputs .form-group-inline {
            justify-content: flex-end;
        }

        .compact-scenario .dividend-inputs .form-group-inline label {
            display: none !important;
        }

        .input-with-currency {
            position: relative;
            width: 200px;
        }

        .input-with-currency::before {
            content: '$';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1em;
            font-weight: 600;
            color: #4a5568;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            pointer-events: none;
        }

        .form-group-inline input[type="number"],
        .form-group-inline input[type="text"] {
            width: 200px;
            padding: 8px 12px 8px 28px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1em;
            text-align: right;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-weight: 600;
            color: #2d3748;
        }

        .input-with-currency input[type="number"],
        .input-with-currency input[type="text"] {
            width: 100%;
        }

        .form-group-inline input[type="number"]:focus,
        .form-group-inline input[type="text"]:focus {
            outline: none;
            border-color: #4a5568;
        }

        .form-group-inline input[type="number"]:disabled,
        .form-group-inline input[type="text"]:disabled {
            background: #f7fafc;
            color: #a0aec0;
            cursor: not-allowed;
        }

        .input-with-currency.disabled::before {
            color: #a0aec0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 0.95em;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            line-height: 1;
        }

        input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #2d3748;
            flex-shrink: 0;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #2d3748;
            flex-shrink: 0;
        }

        .checkbox-option label,
        .radio-option label {
            display: inline;
            margin-bottom: 0;
            cursor: pointer;
            line-height: 1.2;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
            min-height: 52px;
        }

        .btn {
            flex: 1;
            height: 52px;
            padding: 0 14px;
            background: #2d3748;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            background: #1a202c;
        }

        .clear-btn {
            flex: 1;
            height: 52px;
            padding: 0 14px;
            background: #cbd5e0;
            color: #4a5568;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clear-btn:hover {
            background: #a0aec0;
        }

        .btn-info {
            background: #4a5568;
            padding: 14px 24px;
            width: 860px;
            max-width: 860px;
            font-size: 1em;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s, width 0.3s ease, max-width 0.3s ease;
        }

        .btn-info:hover {
            background: #2d3748;
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
            line-height: 1.5;
            min-height: 41px;
            align-items: center;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label {
            color: #4a5568;
            line-height: 1.5;
        }

        .result-value {
            font-weight: 600;
            color: #2d3748;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            line-height: 1.5;
            text-align: right;
        }

        .compact-scenario .result-row {
            justify-content: flex-end;
        }

        .compact-scenario .result-label {
            display: none !important;
        }

        .compact-scenario .result-value {
            width: 200px;
            text-align: right;
        }

        .result-row.refund .result-label,
        .result-row.refund .result-value {
            color: #38a169;
            font-weight: 700;
        }

        .result-highlight {
            background: #2d3748;
            color: white;
            margin: 15px -10px -10px;
            padding: 15px 10px;
            border-radius: 0 0 8px 8px;
        }

        .result-highlight .result-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
            line-height: 1.5;
        }

        .result-highlight .result-value {
            color: white;
            font-size: 1.3em;
            line-height: 1.5;
        }

        .compact-scenario .result-highlight .result-row {
            justify-content: flex-end;
        }

        .compact-scenario .result-highlight .result-value {
            width: 200px;
            text-align: right;
        }

        .hidden {
            display: none;
        }

        .info-panel {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: none;
            width: 860px;
            max-width: 860px;
            transition: width 0.3s ease, max-width 0.3s ease;
        }

        .info-panel.active {
            display: block;
        }

        .info-panel h3 {
            color: #2d3748;
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .info-panel h3:first-child {
            margin-top: 0;
        }

        .info-panel ul {
            margin-left: 20px;
            color: #4a5568;
            line-height: 1.6;
        }

        .info-panel p {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .info-panel table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .info-panel th,
        .info-panel td {
            padding: 8px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }

        .info-panel th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }

        @media (max-width: 768px) {
            .scenarios-container {
                flex-direction: column;
            }

            .scenario-card {
                width: 100% !important;
                min-width: 0 !important;
                border-radius: 12px !important;
                margin-bottom: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .year-buttons {
                flex-direction: column;
            }

            .year-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Australian Tax Calculator</h1>
        <p class="subtitle">Compare Tax Across Financial Years & Scenarios</p>

        <div class="year-selector">
            <h3>Select Financial Year</h3>
            <div class="year-buttons">
                <button class="year-btn active" onclick="selectYear('2026')" id="btn-2026">2025-26</button>
                <button class="year-btn" onclick="selectYear('2025')" id="btn-2025">2024-25</button>
                <button class="year-btn" onclick="selectYear('2024')" id="btn-2024">2023-24</button>
                <button class="year-btn" onclick="selectYear('2023')" id="btn-2023">2022-23</button>
            </div>
        </div>

        <button class="btn btn-info" onclick="toggleInfo()">
            <span id="infoToggleText">View Tax Information</span>
        </button>

        <div id="infoPanel" class="info-panel">
            <div id="taxRatesInfo"></div>
        </div>

        <div id="scenariosContainer" class="scenarios-container">
            <!-- Scenarios will be dynamically generated -->
        </div>
    </div>

<script>
    let selectedYear = '2026';
    let visibleScenarios = [1];

    const AU = new Intl.NumberFormat('en-AU', { style: 'currency', currency: 'AUD', maximumFractionDigits: 0 });

    function formatCurrency(n) {
        const value = Math.round(n || 0);
        if (value < 0) {
            return '(' + AU.format(Math.abs(value)) + ')';
        }
        return AU.format(value);
    }

    function formatNumberInput(input) {
        let value = input.value.replace(/,/g, '');
        if (value === '' || isNaN(value)) {
            input.value = '';
            return;
        }
        input.value = parseInt(value).toLocaleString('en-US');
    }

    function getNumericValue(input) {
        return parseFloat(input.value.replace(/,/g, '')) || 0;
    }

    const taxConfig = {
        '2023': {
            name: '2022-23',
            rates: [
                { limit: 18200, rate: 0, base: 0 },
                { limit: 45000, rate: 0.19, base: 0 },
                { limit: 120000, rate: 0.325, base: 5092 },
                { limit: 180000, rate: 0.37, base: 29467 },
                { limit: Infinity, rate: 0.45, base: 51667 }
            ],
            nonResRates: [
                { limit: 120000, rate: 0.325, base: 0 },
                { limit: 180000, rate: 0.37, base: 39000 },
                { limit: Infinity, rate: 0.45, base: 61200 }
            ],
            helpThreshold: 48361,
            helpRates: 'old',
            medicareThreshold: 24276,
            lito: { max: 700, threshold1: 37500, threshold2: 45000, threshold3: 66667 },
            sapto: { max: 2230, threshold: 32279, cutout: 50119 }
        },
        '2024': {
            name: '2023-24',
            rates: [
                { limit: 18200, rate: 0, base: 0 },
                { limit: 45000, rate: 0.19, base: 0 },
                { limit: 120000, rate: 0.325, base: 5092 },
                { limit: 180000, rate: 0.37, base: 29467 },
                { limit: Infinity, rate: 0.45, base: 51667 }
            ],
            nonResRates: [
                { limit: 120000, rate: 0.325, base: 0 },
                { limit: 180000, rate: 0.37, base: 39000 },
                { limit: Infinity, rate: 0.45, base: 61200 }
            ],
            helpThreshold: 51549,
            helpRates: 'old',
            medicareThreshold: 26000,
            lito: { max: 700, threshold1: 37500, threshold2: 45000, threshold3: 66667 },
            sapto: { max: 2230, threshold: 32279, cutout: 50119 }
        },
        '2025': {
            name: '2024-25',
            rates: [
                { limit: 18200, rate: 0, base: 0 },
                { limit: 45000, rate: 0.16, base: 0 },
                { limit: 135000, rate: 0.30, base: 4288 },
                { limit: 190000, rate: 0.37, base: 31288 },
                { limit: Infinity, rate: 0.45, base: 51638 }
            ],
            nonResRates: [
                { limit: 135000, rate: 0.30, base: 0 },
                { limit: 190000, rate: 0.37, base: 40500 },
                { limit: Infinity, rate: 0.45, base: 60850 }
            ],
            helpThreshold: 54435,
            helpRates: 'old',
            medicareThreshold: 27222,
            lito: { max: 700, threshold1: 37500, threshold2: 45000, threshold3: 66667 },
            sapto: { max: 2230, threshold: 34919, cutout: 52759 }
        },
        '2026': {
            name: '2025-26',
            rates: [
                { limit: 18200, rate: 0, base: 0 },
                { limit: 45000, rate: 0.16, base: 0 },
                { limit: 135000, rate: 0.30, base: 4288 },
                { limit: 190000, rate: 0.37, base: 31288 },
                { limit: Infinity, rate: 0.45, base: 51638 }
            ],
            nonResRates: [
                { limit: 135000, rate: 0.30, base: 0 },
                { limit: 190000, rate: 0.37, base: 40500 },
                { limit: Infinity, rate: 0.45, base: 60850 }
            ],
            helpThreshold: 67000,
            helpRates: 'marginal',
            medicareThreshold: 27222,
            lito: { max: 700, threshold1: 37500, threshold2: 45000, threshold3: 66667 },
            sapto: { max: 2230, threshold: 34919, cutout: 52759 }
        }
    };

    function createScenarioHTML(num) {
        const compactClass = num > 1 ? ' compact-scenario' : '';
        const dividendCheckbox = num === 1 ? `
                <div class="checkbox-section">
                    <div class="checkbox-option">
                        <input type="checkbox" id="dividend1" onchange="toggleDividendAll()">
                        <label for="dividend1">Dividend Income</label>
                    </div>
                </div>` : `<div class="checkbox-section" style="visibility: hidden; height: 40px;"></div>`;
        
        // Add buttons based on scenario number
        let controlButton = '';
        if (num < 4) {
            // Scenarios 1, 2, 3 get a + button
            controlButton += `<button class="scenario-control-btn add-btn" onclick="addFromScenario(${num})">+</button>`;
        }
        if (num > 1) {
            // Scenarios 2, 3, 4 get a − button
            controlButton += `<button class="scenario-control-btn remove-btn" onclick="removeScenario(${num})">−</button>`;
        }
        
        return `
            <div id="scenario${num}" class="scenario-card${compactClass} ${num > 1 ? 'hidden' : ''}">
                ${controlButton}
                <div class="residency-section">
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="resident${num}" name="resident${num}" value="resident" checked>
                            <label for="resident${num}">Australian Resident</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="nonresident${num}" name="resident${num}" value="nonresident">
                            <label for="nonresident${num}">Non-Resident</label>
                        </div>
                    </div>
                </div>

                <h2 class="scenario-header">
                    <input type="text" 
                           id="scenarioName${num}" 
                           class="scenario-name-input" 
                           placeholder="Scenario ${num}" 
                           maxlength="50">
                </h2>
                
                <div class="form-group-inline">
                    <label for="income${num}">Annual Income</label>
                    <div class="input-with-currency">
                        <input type="text" id="income${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0">
                    </div>
                </div>

                ${dividendCheckbox}

                <div id="dividendInputs${num}" class="dividend-inputs hidden">
                    <div class="form-group-inline">
                        <label for="dividendAmount${num}">Dividend Amount</label>
                        <div class="input-with-currency">
                            <input type="text" id="dividendAmount${num}" value="" 
                                   oninput="calculateDividend(${num})" 
                                   onblur="formatNumberInput(this)" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group-inline">
                        <label for="frankingCredit${num}">Franking Credit</label>
                        <div class="input-with-currency">
                            <input type="text" id="frankingCredit${num}" value="" 
                                   oninput="calculateDividend(${num})" 
                                   onblur="formatNumberInput(this)" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group-inline">
                        <label for="totalAssessableDividend${num}">Total Assessable Dividend</label>
                        <div class="input-with-currency">
                            <input type="text" id="totalAssessableDividend${num}" value="0" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-group-inline">
                    <label for="deductionsAmount${num}">Deductions</label>
                    <div class="input-with-currency">
                        <input type="text" id="deductionsAmount${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0">
                    </div>
                </div>

                <div class="form-group-inline">
                    <label for="superannuationAmount${num}">Concessional Super Contributions</label>
                    <div class="input-with-currency">
                        <input type="text" id="superannuationAmount${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0">
                    </div>
                </div>

                <div class="form-group-inline">
                    <label for="helpDebt${num}">HELP/HECS Debt</label>
                    <div class="input-with-currency">
                        <input type="text" id="helpDebt${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0">
                    </div>
                </div>

                <div class="form-group-inline no-border">
                    <label for="paygWithholdingAmount${num}">PAYG Withholding</label>
                    <div class="input-with-currency">
                        <input type="text" id="paygWithholdingAmount${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0">
                    </div>
                </div>

                <div class="form-group-inline">
                    <label for="paygAmount${num}">PAYG Instalments</label>
                    <div class="input-with-currency">
                        <input type="text" id="paygAmount${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0">
                    </div>
                </div>

                <div class="checkbox-section">
                    <div class="checkbox-option">
                        <input type="checkbox" id="sapto${num}">
                        <label for="sapto${num}">I'm eligible for SAPTO (seniors/pensioners)</label>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn" onclick="calculateTax(${num})">Calculate</button>
                    <button class="clear-btn" onclick="clearScenario(${num})">Clear</button>
                </div>

                <div class="results">
                    <div class="result-row">
                        <span class="result-label" style="font-weight: bold;"><strong>TAXABLE INCOME</strong></span>
                        <span class="result-value" id="baseIncome${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Income Tax</span>
                        <span class="result-value" id="taxOnIncome${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Medicare Levy</span>
                        <span class="result-value" id="medicareLevy${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">HELP/HECS Repayment</span>
                        <span class="result-value" id="helpRepayment${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">LITO (Low Income Offset)</span>
                        <span class="result-value" id="lito${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">SAPTO Offset</span>
                        <span class="result-value" id="sapto${num}Amount">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label" style="font-weight: bold;"><strong>TOTAL TAX PAYABLE</strong></span>
                        <span class="result-value" id="totalTaxPayable${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Franking Credit</span>
                        <span class="result-value" id="frankingCreditOffset${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">PAYG Withholding Paid</span>
                        <span class="result-value" id="paygWithholdingPaid${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">PAYG Instalments Paid</span>
                        <span class="result-value" id="paygPaid${num}">$0</span>
                    </div>
                    <div class="result-row" id="totalTaxRow${num}">
                        <span class="result-label" id="totalTaxLabel${num}" style="font-weight: bold;"><strong>TOTAL TAX</strong></span>
                        <span class="result-value" id="totalTax${num}">$0</span>
                    </div>
                    
                    <div class="result-highlight">
                        <div class="result-row">
                            <span class="result-label">Net Annual Income</span>
                            <span class="result-value" id="netAnnual${num}">$0</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Net Monthly Income</span>
                            <span class="result-value" id="netMonthly${num}">$0</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Net Weekly Income</span>
                            <span class="result-value" id="netWeekly${num}">$0</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function toggleDividendAll() {
        const checkbox = document.getElementById('dividend1');
        
        // Toggle dividend inputs for all scenarios (1-4)
        for (let num = 1; num <= 4; num++) {
            const dividendInputs = document.getElementById('dividendInputs' + num);
            
            if (checkbox.checked) {
                dividendInputs.classList.remove('hidden');
                const dividendAmount = document.getElementById('dividendAmount' + num);
                const frankingCredit = document.getElementById('frankingCredit' + num);
                if (!dividendAmount.value) dividendAmount.value = '0';
                if (!frankingCredit.value) frankingCredit.value = '0';
                calculateDividend(num);
            } else {
                dividendInputs.classList.add('hidden');
                document.getElementById('dividendAmount' + num).value = '';
                document.getElementById('frankingCredit' + num).value = '';
                document.getElementById('totalAssessableDividend' + num).value = '0';
            }
        }
    }

    function calculateDividend(num) {
        const dividendAmount = getNumericValue(document.getElementById('dividendAmount' + num));
        const frankingCredit = getNumericValue(document.getElementById('frankingCredit' + num));
        const total = dividendAmount + frankingCredit;
        
        const totalField = document.getElementById('totalAssessableDividend' + num);
        totalField.value = total.toLocaleString('en-US');
    }

    function adjustWidths() {
        const scenario1 = document.getElementById('scenario1');
        const yearSelector = document.querySelector('.year-selector');
        const infoPanel = document.getElementById('infoPanel');
        const infoButton = document.querySelector('.btn-info');
        
        let totalWidth;
        
        if (visibleScenarios.length === 1) {
            // Only Scenario 1
            scenario1.style.setProperty('box-sizing', 'border-box', 'important');
            scenario1.style.setProperty('width', '860px', 'important');
            scenario1.style.setProperty('min-width', '860px', 'important');
            scenario1.style.setProperty('max-width', '860px', 'important');
            scenario1.style.setProperty('padding', '30px', 'important');
            scenario1.style.setProperty('flex-shrink', '0', 'important');
            scenario1.style.borderRadius = '12px';
            totalWidth = 860;
        } else {
            // Multiple scenarios
            scenario1.style.setProperty('box-sizing', 'border-box', 'important');
            scenario1.style.setProperty('width', '535px', 'important');
            scenario1.style.setProperty('min-width', '535px', 'important');
            scenario1.style.setProperty('max-width', '535px', 'important');
            scenario1.style.setProperty('padding', '30px', 'important');
            scenario1.style.setProperty('flex-shrink', '0', 'important');
            scenario1.style.borderRadius = '12px 0 0 12px';
            
            // Calculate total width: 535px (Scenario 1) + 290px per additional scenario
            totalWidth = 535 + (290 * (visibleScenarios.length - 1));
        }
        
        // Apply width to year-selector
        if (yearSelector) {
            yearSelector.style.width = totalWidth + 'px';
            yearSelector.style.maxWidth = totalWidth + 'px';
        }
        
        // Apply width to info panel
        if (infoPanel) {
            infoPanel.style.width = totalWidth + 'px';
            infoPanel.style.maxWidth = totalWidth + 'px';
        }
        
        // Apply width to info button
        if (infoButton) {
            infoButton.style.width = totalWidth + 'px';
            infoButton.style.maxWidth = totalWidth + 'px';
        }
    }

    function copyScenarioValues(fromNum, toNum) {
        // Copy income
        const fromIncome = document.getElementById('income' + fromNum);
        const toIncome = document.getElementById('income' + toNum);
        if (fromIncome && toIncome) toIncome.value = fromIncome.value;

        // Copy dividend inputs
        const fromDividendAmount = document.getElementById('dividendAmount' + fromNum);
        const toDividendAmount = document.getElementById('dividendAmount' + toNum);
        if (fromDividendAmount && toDividendAmount) toDividendAmount.value = fromDividendAmount.value;

        const fromFrankingCredit = document.getElementById('frankingCredit' + fromNum);
        const toFrankingCredit = document.getElementById('frankingCredit' + toNum);
        if (fromFrankingCredit && toFrankingCredit) toFrankingCredit.value = fromFrankingCredit.value;

        // Recalculate dividend for the new scenario
        if (toDividendAmount && toFrankingCredit) {
            calculateDividend(toNum);
        }

        // Copy deductions
        const fromDeductions = document.getElementById('deductionsAmount' + fromNum);
        const toDeductions = document.getElementById('deductionsAmount' + toNum);
        if (fromDeductions && toDeductions) toDeductions.value = fromDeductions.value;

        // Copy superannuation
        const fromSuper = document.getElementById('superannuationAmount' + fromNum);
        const toSuper = document.getElementById('superannuationAmount' + toNum);
        if (fromSuper && toSuper) toSuper.value = fromSuper.value;

        // Copy HELP debt
        const fromHelp = document.getElementById('helpDebt' + fromNum);
        const toHelp = document.getElementById('helpDebt' + toNum);
        if (fromHelp && toHelp) toHelp.value = fromHelp.value;

        // Copy PAYG Withholding
        const fromPaygWith = document.getElementById('paygWithholdingAmount' + fromNum);
        const toPaygWith = document.getElementById('paygWithholdingAmount' + toNum);
        if (fromPaygWith && toPaygWith) toPaygWith.value = fromPaygWith.value;

        // Copy PAYG Instalments
        const fromPayg = document.getElementById('paygAmount' + fromNum);
        const toPayg = document.getElementById('paygAmount' + toNum);
        if (fromPayg && toPayg) toPayg.value = fromPayg.value;

        // Copy residency status
        const fromResident = document.querySelector(`input[name="resident${fromNum}"]:checked`);
        if (fromResident) {
            const toResident = document.querySelector(`input[name="resident${toNum}"][value="${fromResident.value}"]`);
            if (toResident) toResident.checked = true;
        }

        // Copy SAPTO checkbox
        const fromSapto = document.getElementById('sapto' + fromNum);
        const toSapto = document.getElementById('sapto' + toNum);
        if (fromSapto && toSapto) toSapto.checked = fromSapto.checked;
    }

    function addFromScenario(sourceNum) {
        // Find the first hidden scenario to add
        for (let num = 2; num <= 4; num++) {
            if (!visibleScenarios.includes(num)) {
                const card = document.getElementById('scenario' + num);
                card.classList.remove('hidden');
                visibleScenarios.push(num);
                visibleScenarios.sort((a, b) => a - b);
                
                // Copy values from source scenario to new scenario
                copyScenarioValues(sourceNum, num);
                
                // Adjust widths
                adjustWidths();
                
                return;
            }
        }
    }

    function removeScenario(num) {
        // Can't remove Scenario 1
        if (num === 1) return;
        
        // Shift all scenarios after the removed one down by one position
        for (let i = num; i < 4; i++) {
            const nextScenario = i + 1;
            if (visibleScenarios.includes(nextScenario)) {
                // Copy all values from next scenario to current scenario
                copyScenarioValues(nextScenario, i);
                
                // Copy scenario name
                const fromName = document.getElementById('scenarioName' + nextScenario);
                const toName = document.getElementById('scenarioName' + i);
                if (fromName && toName) {
                    toName.value = fromName.value;
                }
            }
        }
        
        // Find the highest visible scenario and hide it
        const highestScenario = Math.max(...visibleScenarios);
        const card = document.getElementById('scenario' + highestScenario);
        card.classList.add('hidden');
        
        // Clear the highest scenario's data and name
        clearScenario(highestScenario);
        const scenarioNameEl = document.getElementById('scenarioName' + highestScenario);
        if (scenarioNameEl) scenarioNameEl.value = '';
        
        // Update visibleScenarios array to always be sequential
        visibleScenarios = visibleScenarios.filter(s => s !== highestScenario);
        
        // Adjust widths
        adjustWidths();
    }

    function selectYear(year) {
        selectedYear = year;
        
        document.querySelectorAll('.year-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + year).classList.add('active');
        
        visibleScenarios.forEach(s => computeScenario(s));
    }

    function toggleScenario(num) {
        const card = document.getElementById('scenario' + num);
        const button = document.getElementById('toggleBtn' + num);
        const text = document.getElementById('toggleText' + num);
        
        if (visibleScenarios.includes(num)) {
            card.classList.add('hidden');
            visibleScenarios = visibleScenarios.filter(s => s !== num);
            text.textContent = '+ Add Scenario ' + num;
            
            if (num === 2) {
                document.getElementById('toggleBtn3').classList.add('hidden');
                document.getElementById('toggleBtn4').classList.add('hidden');
            }
            if (num === 3) {
                document.getElementById('toggleBtn4').classList.add('hidden');
            }
        } else {
            card.classList.remove('hidden');
            visibleScenarios.push(num);
            visibleScenarios.sort((a, b) => a - b);
            text.textContent = '- Remove Scenario ' + num;
            
            if (num === 2 && !visibleScenarios.includes(3)) {
                document.getElementById('toggleBtn3').classList.remove('hidden');
            }
            if (num === 3 && !visibleScenarios.includes(4)) {
                document.getElementById('toggleBtn4').classList.remove('hidden');
            }
        }
    }

    function calculateIncomeTax(income, isResident) {
        const config = taxConfig[selectedYear];
        const rates = isResident ? config.rates : config.nonResRates;
        
        if (income <= 0) return 0;
        
        let tax = 0;
        for (let i = 0; i < rates.length; i++) {
            if (income <= rates[i].limit) {
                const prevLimit = i === 0 ? 0 : rates[i - 1].limit;
                const taxableInThisBracket = income - prevLimit;
                tax = rates[i].base + (taxableInThisBracket * rates[i].rate);
                break;
            }
        }
        
        return Math.max(0, tax);
    }

    function calculateMedicareLevy(income, isResident) {
        if (!isResident) return 0;
        
        const config = taxConfig[selectedYear];
        const threshold = config.medicareThreshold;
        
        if (income <= threshold) return 0;
        
        const shadeOutEnd = threshold * 1.1;
        if (income <= shadeOutEnd) {
            return Math.min(income * 0.02, (income - threshold) * 0.1);
        }
        
        return income * 0.02;
    }

    function calculateHelpRepayment(income, debt) {
        if (debt <= 0) return 0;
        
        const config = taxConfig[selectedYear];
        
        if (income < config.helpThreshold) return 0;
        
        let repayment = 0;
        
        if (config.helpRates === 'marginal') {
            if (income <= 125000) {
                repayment = (income - config.helpThreshold) * 0.15;
            } else if (income <= 179285) {
                repayment = 8700 + (income - 125000) * 0.17;
            } else {
                repayment = income * 0.10;
            }
        } else {
            const rates = [
                { threshold: 54435, rate: 0.01 },
                { threshold: 62851, rate: 0.02 },
                { threshold: 66621, rate: 0.025 },
                { threshold: 70619, rate: 0.03 },
                { threshold: 74856, rate: 0.035 },
                { threshold: 79347, rate: 0.04 },
                { threshold: 84108, rate: 0.045 },
                { threshold: 89155, rate: 0.05 },
                { threshold: 94504, rate: 0.055 },
                { threshold: 100175, rate: 0.06 },
                { threshold: 106186, rate: 0.065 },
                { threshold: 112556, rate: 0.07 },
                { threshold: 119309, rate: 0.075 },
                { threshold: 126468, rate: 0.08 },
                { threshold: 134062, rate: 0.085 },
                { threshold: 142117, rate: 0.09 },
                { threshold: 150664, rate: 0.095 },
                { threshold: Infinity, rate: 0.10 }
            ];
            
            for (let i = 0; i < rates.length; i++) {
                if (income <= rates[i].threshold) {
                    repayment = income * rates[i].rate;
                    break;
                }
            }
        }
        
        return Math.min(repayment, debt);
    }

    function calculateLITO(income, isResident) {
        if (!isResident) return 0;
        
        const config = taxConfig[selectedYear];
        const lito = config.lito;
        
        if (income <= lito.threshold1) {
            return lito.max;
        } else if (income <= lito.threshold2) {
            return lito.max;
        } else if (income <= lito.threshold3) {
            const reduction = (income - lito.threshold2) * 0.05;
            return Math.max(0, lito.max - reduction);
        }
        
        return 0;
    }

    function calculateSAPTO(income, isResident, hasSapto) {
        if (!isResident || !hasSapto) return 0;
        
        const config = taxConfig[selectedYear];
        const sapto = config.sapto;
        
        if (income <= sapto.threshold) {
            return sapto.max;
        } else if (income < sapto.cutout) {
            const reduction = (income - sapto.threshold) * 0.125;
            return Math.max(0, sapto.max - reduction);
        }
        
        return 0;
    }

    function computeScenario(scenario) {
        const incomeEl = document.getElementById('income' + scenario);
        const baseIncome = getNumericValue(incomeEl);
        
        const dividendAmountEl = document.getElementById('dividendAmount' + scenario);
        const frankingCreditEl = document.getElementById('frankingCredit' + scenario);
        const totalAssessableDividendEl = document.getElementById('totalAssessableDividend' + scenario);
        
        const dividendAmount = getNumericValue(dividendAmountEl);
        const frankingCredit = getNumericValue(frankingCreditEl);
        const totalAssessableDividend = getNumericValue(totalAssessableDividendEl);
        
        const deductionsEl = document.getElementById('deductionsAmount' + scenario);
        const deductions = getNumericValue(deductionsEl);
        
        const superannuationEl = document.getElementById('superannuationAmount' + scenario);
        const superannuation = getNumericValue(superannuationEl);
        
        const income = baseIncome + totalAssessableDividend - deductions - superannuation;

        const isResident = document.querySelector(`input[name="resident${scenario}"]:checked`).value === 'resident';
        const helpDebtEl = document.getElementById('helpDebt' + scenario);
        const helpDebt = getNumericValue(helpDebtEl);
        const hasHelp = helpDebt > 0;
        const hasSapto = document.getElementById('sapto' + scenario).checked;
        
        const paygWithholdingEl = document.getElementById('paygWithholdingAmount' + scenario);
        const paygWithholdingAmount = getNumericValue(paygWithholdingEl);
        
        const paygEl = document.getElementById('paygAmount' + scenario);
        const paygAmount = getNumericValue(paygEl);

        const incomeTax = calculateIncomeTax(income, isResident);
        const medicareLevy = calculateMedicareLevy(income, isResident);
        const helpRepayment = hasHelp ? calculateHelpRepayment(income, helpDebt) : 0;
        const lito = calculateLITO(income, isResident);
        const sapto = calculateSAPTO(income, isResident, hasSapto);

        const totalOffsets = lito + sapto;
        const taxAfterOffsets = Math.max(0, incomeTax - totalOffsets);

        const totalTaxPayable = taxAfterOffsets + medicareLevy + helpRepayment;
        const totalTax = totalTaxPayable - frankingCredit - paygWithholdingAmount - paygAmount;
        const netIncome = income - totalTax;
        
        const totalTaxLabel = document.getElementById('totalTaxLabel' + scenario);
        const totalTaxRow = document.getElementById('totalTaxRow' + scenario);
        if (totalTax < 0) {
            totalTaxLabel.innerHTML = '<strong>TOTAL TAX (REFUND)</strong>';
            totalTaxRow.classList.add('refund');
        } else {
            totalTaxLabel.innerHTML = '<strong>TOTAL TAX</strong>';
            totalTaxRow.classList.remove('refund');
        }

        document.getElementById('baseIncome' + scenario).textContent = formatCurrency(income);
        document.getElementById('taxOnIncome' + scenario).textContent = formatCurrency(incomeTax);
        document.getElementById('medicareLevy' + scenario).textContent = formatCurrency(medicareLevy);
        document.getElementById('helpRepayment' + scenario).textContent = formatCurrency(helpRepayment);
        document.getElementById('sapto' + scenario + 'Amount').textContent = formatCurrency(-sapto);
        document.getElementById('lito' + scenario).textContent = formatCurrency(-lito);
        document.getElementById('totalTaxPayable' + scenario).textContent = formatCurrency(totalTaxPayable);
        document.getElementById('frankingCreditOffset' + scenario).textContent = formatCurrency(-frankingCredit);
        document.getElementById('paygWithholdingPaid' + scenario).textContent = formatCurrency(-paygWithholdingAmount);
        document.getElementById('paygPaid' + scenario).textContent = formatCurrency(-paygAmount);
        document.getElementById('totalTax' + scenario).textContent = formatCurrency(totalTax);
        document.getElementById('netAnnual' + scenario).textContent = formatCurrency(netIncome);
        document.getElementById('netMonthly' + scenario).textContent = formatCurrency(netIncome / 12);
        document.getElementById('netWeekly' + scenario).textContent = formatCurrency(netIncome / 52);
    }

    function calculateTax(scenario) { 
        computeScenario(scenario); 
    }

    function updateInfoPanel() {
        const config = taxConfig[selectedYear];
        const infoDiv = document.getElementById('taxRatesInfo');
        
        let html = '<h3>' + config.name + ' Tax Rates</h3>';
        html += '<table><thead><tr><th>Taxable Income</th><th>Tax Rate</th></tr></thead><tbody>';
        
        let prevLimit = 0;
        config.rates.forEach((rate, i) => {
            const limitStr = rate.limit === Infinity ? 'and above' : formatCurrency(rate.limit);
            const fromStr = i === 0 ? '$0' : formatCurrency(prevLimit + 1);
            const rateStr = rate.rate === 0 ? 'Tax free' : (rate.rate * 100) + '%';
            html += `<tr><td>${fromStr} - ${limitStr}</td><td>${rateStr}</td></tr>`;
            prevLimit = rate.limit;
        });
        
        html += '</tbody></table>';
        
        html += '<h3>Medicare Levy</h3>';
        html += '<p>2% of taxable income for Australian residents (threshold ' + formatCurrency(config.medicareThreshold) + ' for singles)</p>';
        
        html += '<h3>HELP/HECS Repayments</h3>';
        if (config.helpRates === 'marginal') {
            html += '<ul>';
            html += '<li>Minimum threshold: ' + formatCurrency(config.helpThreshold) + '</li>';
            html += '<li>' + formatCurrency(config.helpThreshold) + ' - $125,000: 15% of amount over ' + formatCurrency(config.helpThreshold) + '</li>';
            html += '<li>$125,001 - $179,285: $8,700 + 17% of amount over $125,000</li>';
            html += '<li>$179,286+: 10% of total income</li>';
            html += '</ul>';
        } else {
            html += '<p>Minimum threshold: ' + formatCurrency(config.helpThreshold) + '</p>';
            html += '<p>Repayment rates range from 1% to 10% of total income based on income level.</p>';
        }
        html += '<p><em>Note: HELP repayments are capped at your current debt balance.</em></p>';
        
        html += '<h3>Tax Offsets</h3>';
        html += '<p><strong>LITO (Low Income Tax Offset):</strong> Up to $' + config.lito.max + ' for incomes up to $' + config.lito.threshold1.toLocaleString() + ', phasing out to zero at $' + config.lito.threshold3.toLocaleString() + '</p>';
        html += '<p><strong>SAPTO (Seniors and Pensioners):</strong> Up to $' + config.sapto.max + ' for singles, phasing out from $' + config.sapto.threshold.toLocaleString() + ' to $' + config.sapto.cutout.toLocaleString() + '</p>';
        
        infoDiv.innerHTML = html;
    }

    function toggleInfo() {
        const panel = document.getElementById('infoPanel');
        const text = document.getElementById('infoToggleText');
        if (panel.classList.contains('active')) {
            panel.classList.remove('active');
            text.textContent = 'View Tax Information';
        } else {
            updateInfoPanel();
            panel.classList.add('active');
            text.textContent = 'Hide Tax Information';
        }
    }

    function clearScenario(num) {
        const incomeEl = document.getElementById('income' + num);
        if (incomeEl) incomeEl.value = '';

        // Only handle dividend checkbox in Scenario 1, which controls all scenarios
        if (num === 1) {
            const dividendCheck = document.getElementById('dividend1');
            if (dividendCheck) {
                dividendCheck.checked = false;
                // This will hide dividend inputs for all scenarios
                toggleDividendAll();
            }
        } else {
            // For other scenarios, just clear the dividend values
            const dividendAmount = document.getElementById('dividendAmount' + num);
            if (dividendAmount) dividendAmount.value = '';
            const frankingCreditEl = document.getElementById('frankingCredit' + num);
            if (frankingCreditEl) frankingCreditEl.value = '';
            const totalAssessableDividend = document.getElementById('totalAssessableDividend' + num);
            if (totalAssessableDividend) totalAssessableDividend.value = '0';
        }

        const deductionsAmount = document.getElementById('deductionsAmount' + num);
        if (deductionsAmount) deductionsAmount.value = '';

        const superannuationAmount = document.getElementById('superannuationAmount' + num);
        if (superannuationAmount) superannuationAmount.value = '';

        const residentRadio = document.querySelector(`input[name="resident${num}"][value="resident"]`);
        if (residentRadio) residentRadio.checked = true;

        const helpDebtEl = document.getElementById('helpDebt' + num);
        if (helpDebtEl) helpDebtEl.value = '';

        const paygWithholdingEl = document.getElementById('paygWithholdingAmount' + num);
        if (paygWithholdingEl) paygWithholdingEl.value = '';

        const paygEl = document.getElementById('paygAmount' + num);
        if (paygEl) paygEl.value = '';

        const saptoCheck = document.getElementById('sapto' + num);
        if (saptoCheck) saptoCheck.checked = false;

        const resultFields = [
            'baseIncome', 'taxOnIncome', 'medicareLevy', 'helpRepayment', 
            'lito', 'totalTaxPayable', 'frankingCreditOffset', 'paygWithholdingPaid', 'paygPaid', 'totalTax', 'netAnnual', 'netMonthly', 'netWeekly'
        ];
        
        resultFields.forEach(field => {
            const el = document.getElementById(field + num);
            if (el) el.textContent = '$0';
        });

        const saptoAmountEl = document.getElementById('sapto' + num + 'Amount');
        if (saptoAmountEl) saptoAmountEl.textContent = '$0';
        
        const totalTaxLabel = document.getElementById('totalTaxLabel' + num);
        if (totalTaxLabel) totalTaxLabel.innerHTML = '<strong>TOTAL TAX</strong>';
        
        const totalTaxRow = document.getElementById('totalTaxRow' + num);
        if (totalTaxRow) totalTaxRow.classList.remove('refund');
    }

    window.onload = function () {
        const container = document.getElementById('scenariosContainer');
        for (let i = 1; i <= 4; i++) {
            container.innerHTML += createScenarioHTML(i);
        }
        // Set initial widths to match Scenario 1
        adjustWidths();
    };
</script>
</body>
</html>
