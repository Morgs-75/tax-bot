<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Tax Calculator - Multi-Year</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .year-selector {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .year-selector h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .year-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .year-btn {
            padding: 12px 24px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #4a5568;
        }

        .year-btn:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .year-btn.active {
            background: #2d3748;
            color: white;
            border-color: #2d3748;
        }

        .comparison-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .clear-btn {
            padding: 12px 24px;
            background: #cbd5e0;
            color: #4a5568;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .clear-btn:hover {
            background: #a0aec0;
        }

        .clear-btn:active {
            transform: translateY(0);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .button-group .btn,
        .button-group .clear-btn {
            flex: 1;
            margin: 0;
        }

        .scenarios-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .scenarios-container.cols-1 {
            grid-template-columns: 2fr 1fr;
        }

        .scenarios-container.cols-1 .scenario-card:first-child {
            grid-column: 1;
        }

        .scenarios-container.cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .scenarios-container.cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .scenarios-container.cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .scenario-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .scenario-header {
            font-size: 1.5em;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.additional-factors-header {
            margin-bottom: 8px;
        }

        .form-group.sapto-section {
            margin-top: 10px;
        }

        .form-group.dividend-section {
            margin-bottom: 8px;
            margin-top: -8px;
        }

        .dividend-inputs {
            margin-bottom: 12px;
        }

        .dividend-inputs.hidden {
            display: none;
        }

        .form-group-inline.dividend-indented {
            padding-left: 30px;
        }

        #totalAssessableDividend1,
        #totalAssessableDividend2,
        #totalAssessableDividend3,
        #totalAssessableDividend4 {
            background: #f7fafc;
            color: #4a5568;
            font-weight: 600;
        }

        .form-group-inline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .form-group-inline.no-border {
            border-bottom: none;
            padding-bottom: 3px;
        }

        .form-group-inline.no-border + .form-group-inline {
            padding-top: 3px;
        }

        .form-group-inline .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group-inline label {
            color: #4a5568;
            font-weight: 500;
            font-size: 0.95em;
            margin: 0;
        }

        .input-with-currency {
            position: relative;
            width: 200px;
            max-width: 150px;
        }

        .scenarios-container.cols-3 .input-with-currency,
        .scenarios-container.cols-4 .input-with-currency {
            width: 150px;
        }

        .input-with-currency::before {
            content: '$';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1em;
            font-weight: 600;
            color: #4a5568;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            pointer-events: none;
        }

        .form-group-inline input[type="number"],
        .form-group-inline input[type="text"] {
            width: 200px;
            max-width: 576px;
            padding: 8px 12px 8px 28px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1em;
            text-align: right;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-weight: 600;
            color: #2d3748;
        }

        .scenarios-container.cols-3 .form-group-inline input[type="number"],
        .scenarios-container.cols-3 .form-group-inline input[type="text"],
        .scenarios-container.cols-4 .form-group-inline input[type="number"],
        .scenarios-container.cols-4 .form-group-inline input[type="text"] {
            width: 150px;
        }

        .input-with-currency input[type="number"],
        .input-with-currency input[type="text"] {
            width: 100%;
        }

        .form-group-inline input[type="number"]:focus,
        .form-group-inline input[type="text"]:focus {
            outline: none;
            border-color: #4a5568;
        }

        .form-group-inline input[type="number"]:disabled,
        .form-group-inline input[type="text"]:disabled {
            background: #f7fafc;
            color: #a0aec0;
            cursor: not-allowed;
        }

        .input-with-currency.disabled::before {
            color: #a0aec0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 0.95em;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #2d3748;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #2d3748;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: #2d3748;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background: #1a202c;
        }

        .btn-secondary {
            background: #4a5568;
            padding: 10px 20px;
            width: auto;
            font-size: 0.9em;
        }

        .btn-secondary:hover {
            background: #2d3748;
        }

        .btn-tertiary {
            background: #718096;
            padding: 10px 20px;
            width: auto;
            font-size: 0.9em;
        }

        .btn-tertiary:hover {
            background: #4a5568;
        }

        .btn-quaternary {
            background: #a0aec0;
            padding: 10px 20px;
            width: auto;
            font-size: 0.9em;
        }

        .btn-quaternary:hover {
            background: #718096;
        }

        .btn-info {
            background: #4a5568;
            padding: 14px 24px;
            width: 100%;
            font-size: 1em;
        }

        .btn-info:hover {
            background: #2d3748;
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .results h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label {
            color: #4a5568;
        }

        .result-value {
            font-weight: 600;
            color: #2d3748;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }

        .result-row.refund .result-label,
        .result-row.refund .result-value {
            color: #38a169;
            font-weight: 700;
        }

        .result-highlight {
            background: #2d3748;
            color: white;
            margin: 15px -10px -10px;
            padding: 15px 10px;
            border-radius: 0 0 8px 8px;
        }

        .result-highlight .result-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
        }

        .result-highlight .result-value {
            color: white;
            font-size: 1.3em;
        }

        .hidden {
            display: none;
        }

        .info-panel {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .info-panel.active {
            display: block;
        }

        .info-panel h3 {
            color: #2d3748;
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .info-panel h3:first-child {
            margin-top: 0;
        }

        .info-panel ul {
            margin-left: 20px;
            color: #4a5568;
            line-height: 1.6;
        }

        .info-panel p {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .info-panel table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .info-panel th,
        .info-panel td {
            padding: 8px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }

        .info-panel th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }

        @media (max-width: 1400px) {
            .scenarios-container.cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .scenarios-container.cols-3 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .scenarios-container.cols-1,
            .scenarios-container.cols-2,
            .scenarios-container.cols-3,
            .scenarios-container.cols-4 {
                grid-template-columns: 1fr;
            }

            .scenarios-container.cols-1 .scenario-card:first-child {
                grid-column: 1;
            }

            h1 {
                font-size: 2em;
            }

            .year-buttons,
            .comparison-controls {
                flex-direction: column;
            }

            .year-btn {
                width: 100%;
            }

            .btn-secondary,
            .btn-tertiary,
            .btn-quaternary {
                width: 100%;
            }

            .form-group-inline {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .input-with-currency {
                width: 100%;
            }

            .form-group-inline input[type="number"],
            .form-group-inline input[type="text"] {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Australian Tax Calculator</h1>
        <p class="subtitle">Compare Tax Accross Financial Years & Scenarios</p>

        <div class="year-selector">
            <h3>Select Financial Year</h3>
            <div class="year-buttons">
                <button class="year-btn active" onclick="selectYear('2026')" id="btn-2026">2025-26</button>
                <button class="year-btn" onclick="selectYear('2025')" id="btn-2025">2024-25</button>
                <button class="year-btn" onclick="selectYear('2024')" id="btn-2024">2023-24</button>
                <button class="year-btn" onclick="selectYear('2023')" id="btn-2023">2022-23</button>
            </div>
        </div>

        <button class="btn btn-info" onclick="toggleInfo()">
            <span id="infoToggleText">View Tax Information</span>
        </button>

        <div id="infoPanel" class="info-panel">
            <div id="taxRatesInfo"></div>
        </div>

        <div class="comparison-controls">
            <button class="btn btn-secondary" onclick="toggleScenario(2)" id="toggleBtn2">
                <span id="toggleText2">+ Add Scenario 2</span>
            </button>
            <button class="btn btn-tertiary hidden" onclick="toggleScenario(3)" id="toggleBtn3">
                <span id="toggleText3">+ Add Scenario 3</span>
            </button>
            <button class="btn btn-quaternary hidden" onclick="toggleScenario(4)" id="toggleBtn4">
                <span id="toggleText4">+ Add Scenario 4</span>
            </button>
        </div>

        <div id="scenariosContainer" class="scenarios-container">
            <!-- Scenarios will be dynamically generated -->
        </div>
    </div>

<script>
    let selectedYear = '2026';
    let visibleScenarios = [1];

    const AU = new Intl.NumberFormat('en-AU', { style: 'currency', currency: 'AUD', maximumFractionDigits: 0 });

    function formatCurrency(n) {
        const value = Math.round(n || 0);
        if (value < 0) {
            return '(' + AU.format(Math.abs(value)) + ')';
        }
        return AU.format(value);
    }

    function formatNumberInput(input) {
        // Remove non-digit characters except for cursor position tracking
        let value = input.value.replace(/,/g, '');
        if (value === '' || isNaN(value)) {
            input.value = '';
            return;
        }
        // Format with commas
        input.value = parseInt(value).toLocaleString('en-US');
    }

    function getNumericValue(input) {
        // Get the raw numeric value without commas
        return parseFloat(input.value.replace(/,/g, '')) || 0;
    }

    const taxConfig = {
        '2023': {
            name: '2022-23',
            rates: [
                { limit: 18200, rate: 0, base: 0 },
                { limit: 45000, rate: 0.19, base: 0 },
                { limit: 120000, rate: 0.325, base: 5092 },
                { limit: 180000, rate: 0.37, base: 29467 },
                { limit: Infinity, rate: 0.45, base: 51667 }
            ],
            nonResRates: [
                { limit: 120000, rate: 0.325, base: 0 },
                { limit: 180000, rate: 0.37, base: 39000 },
                { limit: Infinity, rate: 0.45, base: 61200 }
            ],
            helpThreshold: 48361,
            helpRates: 'old',
            medicareThreshold: 24276,
            lito: { max: 700, threshold1: 37500, threshold2: 45000, threshold3: 66667 },
            sapto: { max: 2230, threshold: 32279, cutout: 50119 }
        },
        '2024': {
            name: '2023-24',
            rates: [
                { limit: 18200, rate: 0, base: 0 },
                { limit: 45000, rate: 0.19, base: 0 },
                { limit: 120000, rate: 0.325, base: 5092 },
                { limit: 180000, rate: 0.37, base: 29467 },
                { limit: Infinity, rate: 0.45, base: 51667 }
            ],
            nonResRates: [
                { limit: 120000, rate: 0.325, base: 0 },
                { limit: 180000, rate: 0.37, base: 39000 },
                { limit: Infinity, rate: 0.45, base: 61200 }
            ],
            helpThreshold: 51549,
            helpRates: 'old',
            medicareThreshold: 26000,
            lito: { max: 700, threshold1: 37500, threshold2: 45000, threshold3: 66667 },
            sapto: { max: 2230, threshold: 32279, cutout: 50119 }
        },
        '2025': {
            name: '2024-25',
            rates: [
                { limit: 18200, rate: 0, base: 0 },
                { limit: 45000, rate: 0.16, base: 0 },
                { limit: 135000, rate: 0.30, base: 4288 },
                { limit: 190000, rate: 0.37, base: 31288 },
                { limit: Infinity, rate: 0.45, base: 51638 }
            ],
            nonResRates: [
                { limit: 135000, rate: 0.30, base: 0 },
                { limit: 190000, rate: 0.37, base: 40500 },
                { limit: Infinity, rate: 0.45, base: 60850 }
            ],
            helpThreshold: 54435,
            helpRates: 'old',
            medicareThreshold: 27222,
            lito: { max: 700, threshold1: 37500, threshold2: 45000, threshold3: 66667 },
            sapto: { max: 2230, threshold: 34919, cutout: 52759 }
        },
        '2026': {
            name: '2025-26',
            rates: [
                { limit: 18200, rate: 0, base: 0 },
                { limit: 45000, rate: 0.16, base: 0 },
                { limit: 135000, rate: 0.30, base: 4288 },
                { limit: 190000, rate: 0.37, base: 31288 },
                { limit: Infinity, rate: 0.45, base: 51638 }
            ],
            nonResRates: [
                { limit: 135000, rate: 0.30, base: 0 },
                { limit: 190000, rate: 0.37, base: 40500 },
                { limit: Infinity, rate: 0.45, base: 60850 }
            ],
            helpThreshold: 67000,
            helpRates: 'marginal',
            medicareThreshold: 27222,
            lito: { max: 700, threshold1: 37500, threshold2: 45000, threshold3: 66667 },
            sapto: { max: 2230, threshold: 34919, cutout: 52759 }
        }
    };

    function createScenarioHTML(num) {
        return `
            <div id="scenario${num}" class="scenario-card ${num > 1 ? 'hidden' : ''}">
                <h2 class="scenario-header">Scenario ${num}</h2>
                
                <div class="form-group-inline">
                    <label for="income${num}">Annual Income</label>
                    <div class="input-with-currency">
                        <input type="text" id="income${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0">
                    </div>
                </div>

                <div class="form-group dividend-section">
                    <div class="checkbox-option">
                        <input type="checkbox" id="dividend${num}" onchange="toggleDividend(${num})">
                        <label for="dividend${num}">Dividend Income</label>
                    </div>
                </div>

                <div id="dividendInputs${num}" class="dividend-inputs hidden">
                    <div class="form-group-inline dividend-indented">
                        <label for="dividendAmount${num}">Dividend</label>
                        <div class="input-with-currency">
                            <input type="text" id="dividendAmount${num}" value="" 
                                   onblur="formatNumberInput(this); calculateDividend(${num})" placeholder="0">
                        </div>
                    </div>

                    <div class="form-group-inline dividend-indented">
                        <label for="frankingCredit${num}">Franking Credit</label>
                        <div class="input-with-currency">
                            <input type="text" id="frankingCredit${num}" value="" 
                                   onblur="formatNumberInput(this); calculateDividend(${num})" placeholder="0">
                        </div>
                    </div>

                    <div class="form-group-inline">
                        <label for="totalAssessableDividend${num}">Total Assessable Dividend</label>
                        <div class="input-with-currency">
                            <input type="text" id="totalAssessableDividend${num}" value="0" 
                                   readonly disabled>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="resident${num}" name="resident${num}" value="resident" checked>
                            <label for="resident${num}">Australian Resident</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="nonresident${num}" name="resident${num}" value="nonresident">
                            <label for="nonresident${num}">Non-Resident</label>
                        </div>
                    </div>
                </div>

                <div class="form-group additional-factors-header">
                    <label>Additional Factors</label>
                </div>

                <div class="form-group-inline no-border">
                    <div class="checkbox-option">
                        <input type="checkbox" id="help${num}" onchange="toggleHelpDebt(${num})">
                        <label for="help${num}">I have a HELP/HECS debt</label>
                    </div>
                    <div class="input-with-currency disabled">
                        <input type="text" id="helpDebt${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0" disabled>
                    </div>
                </div>

                <div class="form-group-inline no-border">
                    <div class="checkbox-option">
                        <input type="checkbox" id="paygWithholding${num}" onchange="togglePaygWithholding(${num})">
                        <label for="paygWithholding${num}">PAYG Withholding</label>
                    </div>
                    <div class="input-with-currency disabled">
                        <input type="text" id="paygWithholdingAmount${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0" disabled>
                    </div>
                </div>

                <div class="form-group-inline">
                    <div class="checkbox-option">
                        <input type="checkbox" id="payg${num}" onchange="togglePayg(${num})">
                        <label for="payg${num}">PAYG Instalments</label>
                    </div>
                    <div class="input-with-currency disabled">
                        <input type="text" id="paygAmount${num}" value="" 
                               onblur="formatNumberInput(this)" placeholder="0" disabled>
                    </div>
                </div>

                <div class="form-group sapto-section">
                    <div class="checkbox-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="sapto${num}">
                            <label for="sapto${num}">I'm eligible for SAPTO (seniors/pensioners)</label>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn" onclick="calculateTax(${num})">Calculate Tax</button>
                    <button class="clear-btn" onclick="clearScenario(${num})">🗑️ Clear</button>
                </div>

                <div class="results">
                    <h3>Tax Breakdown</h3>
                    <div class="result-row">
                        <span class="result-label">Gross Income:</span>
                        <span class="result-value" id="baseIncome${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Income Tax:</span>
                        <span class="result-value" id="taxOnIncome${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Medicare Levy:</span>
                        <span class="result-value" id="medicareLevy${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">HELP/HECS Repayment:</span>
                        <span class="result-value" id="helpRepayment${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">LITO (Low Income Offset):</span>
                        <span class="result-value" id="lito${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">SAPTO Offset:</span>
                        <span class="result-value" id="sapto${num}Amount">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Franking Credit:</span>
                        <span class="result-value" id="frankingCreditOffset${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">PAYG Withholding Paid:</span>
                        <span class="result-value" id="paygWithholdingPaid${num}">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">PAYG Instalments Paid:</span>
                        <span class="result-value" id="paygPaid${num}">$0</span>
                    </div>
                    <div class="result-row" id="totalTaxRow${num}">
                        <span class="result-label" id="totalTaxLabel${num}">Total Tax:</span>
                        <span class="result-value" id="totalTax${num}">$0</span>
                    </div>
                    
                    <div class="result-highlight">
                        <div class="result-row">
                            <span class="result-label">Net Annual Income:</span>
                            <span class="result-value" id="netAnnual${num}">$0</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Net Monthly Income:</span>
                            <span class="result-value" id="netMonthly${num}">$0</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Net Weekly Income:</span>
                            <span class="result-value" id="netWeekly${num}">$0</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function toggleHelpDebt(num) {
        const checkbox = document.getElementById('help' + num);
        const debtInput = document.getElementById('helpDebt' + num);
        const wrapper = debtInput.parentElement;
        
        if (checkbox.checked) {
            debtInput.disabled = false;
            wrapper.classList.remove('disabled');
            if (!debtInput.value) {
                debtInput.value = '0';
            }
        } else {
            debtInput.disabled = true;
            wrapper.classList.add('disabled');
            debtInput.value = '';
        }
    }

    function togglePayg(num) {
        const checkbox = document.getElementById('payg' + num);
        const paygInput = document.getElementById('paygAmount' + num);
        const wrapper = paygInput.parentElement;
        
        if (checkbox.checked) {
            paygInput.disabled = false;
            wrapper.classList.remove('disabled');
            if (!paygInput.value) {
                paygInput.value = '0';
            }
        } else {
            paygInput.disabled = true;
            wrapper.classList.add('disabled');
            paygInput.value = '';
        }
    }

    function toggleDividend(num) {
        const checkbox = document.getElementById('dividend' + num);
        const dividendInputs = document.getElementById('dividendInputs' + num);
        
        if (checkbox.checked) {
            dividendInputs.classList.remove('hidden');
            // Set default values
            const dividendAmount = document.getElementById('dividendAmount' + num);
            const frankingCredit = document.getElementById('frankingCredit' + num);
            if (!dividendAmount.value) dividendAmount.value = '0';
            if (!frankingCredit.value) frankingCredit.value = '0';
            calculateDividend(num);
        } else {
            dividendInputs.classList.add('hidden');
            // Clear values
            document.getElementById('dividendAmount' + num).value = '';
            document.getElementById('frankingCredit' + num).value = '';
            document.getElementById('totalAssessableDividend' + num).value = '0';
        }
    }

    function calculateDividend(num) {
        const dividendAmount = getNumericValue(document.getElementById('dividendAmount' + num));
        const frankingCredit = getNumericValue(document.getElementById('frankingCredit' + num));
        const total = dividendAmount + frankingCredit;
        
        const totalField = document.getElementById('totalAssessableDividend' + num);
        totalField.value = total.toLocaleString('en-US');
    }

    function togglePaygWithholding(num) {
        const checkbox = document.getElementById('paygWithholding' + num);
        const withholdingInput = document.getElementById('paygWithholdingAmount' + num);
        const wrapper = withholdingInput.parentElement;
        
        if (checkbox.checked) {
            withholdingInput.disabled = false;
            wrapper.classList.remove('disabled');
            if (!withholdingInput.value) {
                withholdingInput.value = '0';
            }
        } else {
            withholdingInput.disabled = true;
            wrapper.classList.add('disabled');
            withholdingInput.value = '';
        }
    }

    function selectYear(year) {
        selectedYear = year;
        document.querySelectorAll('.year-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + year).classList.add('active');
        
        if (document.getElementById('infoPanel').classList.contains('active')) {
            updateInfoPanel();
        }
    }

    function toggleScenario(num) {
        const scenario = document.getElementById('scenario' + num);
        const button = document.getElementById('toggleBtn' + num);
        const text = document.getElementById('toggleText' + num);
        
        if (scenario.classList.contains('hidden')) {
            scenario.classList.remove('hidden');
            visibleScenarios.push(num);
            text.textContent = '− Remove Scenario ' + num;
            
            if (num < 4) {
                document.getElementById('toggleBtn' + (num + 1)).classList.remove('hidden');
            }
        } else {
            scenario.classList.add('hidden');
            visibleScenarios = visibleScenarios.filter(s => s !== num);
            text.textContent = '+ Add Scenario ' + num;
            
            if (num < 4) {
                const nextScenario = document.getElementById('scenario' + (num + 1));
                if (nextScenario.classList.contains('hidden')) {
                    document.getElementById('toggleBtn' + (num + 1)).classList.add('hidden');
                }
            }
        }
        
        updateGridLayout();
    }

    function updateGridLayout() {
        const container = document.getElementById('scenariosContainer');
        container.className = 'scenarios-container';
        
        if (visibleScenarios.length === 1) {
            container.classList.add('cols-1');
        } else if (visibleScenarios.length === 2) {
            container.classList.add('cols-2');
        } else if (visibleScenarios.length === 3) {
            container.classList.add('cols-3');
        } else if (visibleScenarios.length === 4) {
            container.classList.add('cols-4');
        }
    }

    function calculateIncomeTax(income, isResident) {
        const config = taxConfig[selectedYear];
        const rates = isResident ? config.rates : config.nonResRates;
        
        income = Math.max(0, income);
        
        for (let i = 0; i < rates.length; i++) {
            if (income <= rates[i].limit) {
                const prevLimit = i > 0 ? rates[i-1].limit : 0;
                return rates[i].base + (income - prevLimit) * rates[i].rate;
            }
        }
        
        return 0;
    }

    function calculateMedicareLevy(income, isResident) {
        if (!isResident) return 0;
        
        const config = taxConfig[selectedYear];
        const threshold = config.medicareThreshold;
        const phaseOutEnd = threshold * 1.25;
        
        if (income <= threshold) return 0;
        if (income <= phaseOutEnd) return (income - threshold) * 0.10;
        return income * 0.02;
    }

    function calculateHelpRepayment(income, debtBalance) {
        const config = taxConfig[selectedYear];
        
        if (income <= config.helpThreshold || debtBalance <= 0) return 0;
        
        let calculatedRepayment = 0;
        
        if (config.helpRates === 'marginal') {
            if (income <= 125000) calculatedRepayment = 0.15 * (income - 67000);
            else if (income <= 179285) calculatedRepayment = 8700 + 0.17 * (income - 125000);
            else calculatedRepayment = income * 0.10;
        } else {
            if (selectedYear === '2023') {
                if (income <= 51550) calculatedRepayment = income * 0.01;
                else if (income <= 57730) calculatedRepayment = income * 0.02;
                else if (income <= 64307) calculatedRepayment = income * 0.025;
                else if (income <= 70882) calculatedRepayment = income * 0.03;
                else if (income <= 77494) calculatedRepayment = income * 0.035;
                else if (income <= 84069) calculatedRepayment = income * 0.04;
                else if (income <= 90521) calculatedRepayment = income * 0.045;
                else if (income <= 97377) calculatedRepayment = income * 0.05;
                else if (income <= 103765) calculatedRepayment = income * 0.055;
                else if (income <= 110139) calculatedRepayment = income * 0.06;
                else if (income <= 116837) calculatedRepayment = income * 0.065;
                else if (income <= 124242) calculatedRepayment = income * 0.07;
                else if (income <= 131989) calculatedRepayment = income * 0.075;
                else if (income <= 151200) calculatedRepayment = income * 0.08;
                else calculatedRepayment = income * 0.10;
            } else if (selectedYear === '2024' || selectedYear === '2025') {
                if (income <= 54435) calculatedRepayment = income * 0.01;
                else if (income <= 62851) calculatedRepayment = income * 0.02;
                else if (income <= 66621) calculatedRepayment = income * 0.025;
                else if (income <= 70619) calculatedRepayment = income * 0.03;
                else if (income <= 74855) calculatedRepayment = income * 0.035;
                else if (income <= 79346) calculatedRepayment = income * 0.04;
                else if (income <= 84107) calculatedRepayment = income * 0.045;
                else if (income <= 89154) calculatedRepayment = income * 0.05;
                else if (income <= 94504) calculatedRepayment = income * 0.055;
                else if (income <= 100168) calculatedRepayment = income * 0.06;
                else if (income <= 106163) calculatedRepayment = income * 0.065;
                else if (income <= 112507) calculatedRepayment = income * 0.07;
                else if (income <= 119220) calculatedRepayment = income * 0.075;
                else if (income <= 126319) calculatedRepayment = income * 0.08;
                else if (income <= 133808) calculatedRepayment = income * 0.085;
                else if (income <= 141808) calculatedRepayment = income * 0.09;
                else if (income <= 150421) calculatedRepayment = income * 0.095;
                else calculatedRepayment = income * 0.10;
            }
        }
        
        return Math.min(calculatedRepayment, debtBalance);
    }

    function calculateLITO(income, isResident) {
        if (!isResident) return 0;
        
        const config = taxConfig[selectedYear];
        const lito = config.lito;
        
        if (income <= lito.threshold1) return lito.max;
        if (income <= lito.threshold2) return lito.max - ((income - lito.threshold1) * 0.05);
        if (income <= lito.threshold3) return 325 - ((income - lito.threshold2) * 0.015);
        return 0;
    }

    function calculateSAPTO(income, isResident, hasSapto) {
        if (!isResident || !hasSapto) return 0;
        
        const config = taxConfig[selectedYear];
        const sapto = config.sapto;
        const phaseOutRate = 0.125;
        
        if (income <= sapto.threshold) return sapto.max;
        const reduction = (income - sapto.threshold) * phaseOutRate;
        return Math.max(0, sapto.max - reduction);
    }

    function computeScenario(scenario) {
        const incomeEl = document.getElementById('income' + scenario);
        const baseIncome = getNumericValue(incomeEl);
        
        // Get dividend income
        const hasDividend = document.getElementById('dividend' + scenario).checked;
        const totalAssessableDividendEl = document.getElementById('totalAssessableDividend' + scenario);
        const totalAssessableDividend = hasDividend ? getNumericValue(totalAssessableDividendEl) : 0;
        const frankingCreditEl = document.getElementById('frankingCredit' + scenario);
        const frankingCredit = hasDividend ? getNumericValue(frankingCreditEl) : 0;
        
        // Total income includes base income + total assessable dividend
        const income = baseIncome + totalAssessableDividend;

        const isResident = document.querySelector(`input[name="resident${scenario}"]:checked`).value === 'resident';
        const hasHelp = document.getElementById('help' + scenario).checked;
        const helpDebtEl = document.getElementById('helpDebt' + scenario);
        const helpDebt = hasHelp ? getNumericValue(helpDebtEl) : 0;
        const hasSapto = document.getElementById('sapto' + scenario).checked;
        
        const hasPaygWithholding = document.getElementById('paygWithholding' + scenario).checked;
        const paygWithholdingEl = document.getElementById('paygWithholdingAmount' + scenario);
        const paygWithholdingAmount = hasPaygWithholding ? getNumericValue(paygWithholdingEl) : 0;
        
        const hasPayg = document.getElementById('payg' + scenario).checked;
        const paygEl = document.getElementById('paygAmount' + scenario);
        const paygAmount = hasPayg ? getNumericValue(paygEl) : 0;

        const incomeTax = calculateIncomeTax(income, isResident);
        const medicareLevy = calculateMedicareLevy(income, isResident);
        const helpRepayment = hasHelp ? calculateHelpRepayment(income, helpDebt) : 0;
        const lito = calculateLITO(income, isResident);
        const sapto = calculateSAPTO(income, isResident, hasSapto);

        const totalOffsets = lito + sapto;
        const taxAfterOffsets = Math.max(0, incomeTax - totalOffsets);

        const totalTax = taxAfterOffsets + medicareLevy + helpRepayment - frankingCredit - paygWithholdingAmount - paygAmount;
        const netIncome = income - totalTax;
        
        // Update Total Tax label and styling based on whether it's negative (refund)
        const totalTaxLabel = document.getElementById('totalTaxLabel' + scenario);
        const totalTaxRow = document.getElementById('totalTaxRow' + scenario);
        if (totalTax < 0) {
            totalTaxLabel.textContent = 'Total Tax (Refund):';
            totalTaxRow.classList.add('refund');
        } else {
            totalTaxLabel.textContent = 'Total Tax:';
            totalTaxRow.classList.remove('refund');
        }

        document.getElementById('baseIncome' + scenario).textContent = formatCurrency(income);
        document.getElementById('taxOnIncome' + scenario).textContent = formatCurrency(incomeTax);
        document.getElementById('medicareLevy' + scenario).textContent = formatCurrency(medicareLevy);
        document.getElementById('helpRepayment' + scenario).textContent = formatCurrency(helpRepayment);
        document.getElementById('sapto' + scenario + 'Amount').textContent = formatCurrency(-sapto);
        document.getElementById('lito' + scenario).textContent = formatCurrency(-lito);
        document.getElementById('frankingCreditOffset' + scenario).textContent = formatCurrency(-frankingCredit);
        document.getElementById('paygWithholdingPaid' + scenario).textContent = formatCurrency(-paygWithholdingAmount);
        document.getElementById('paygPaid' + scenario).textContent = formatCurrency(-paygAmount);
        document.getElementById('totalTax' + scenario).textContent = formatCurrency(totalTax);
        document.getElementById('netAnnual' + scenario).textContent = formatCurrency(netIncome);
        document.getElementById('netMonthly' + scenario).textContent = formatCurrency(netIncome / 12);
        document.getElementById('netWeekly' + scenario).textContent = formatCurrency(netIncome / 52);
    }

    function calculateTax(scenario) { computeScenario(scenario); }

    function updateInfoPanel() {
        const config = taxConfig[selectedYear];
        const infoDiv = document.getElementById('taxRatesInfo');
        
        let html = '<h3>' + config.name + ' Tax Rates</h3>';
        html += '<table><thead><tr><th>Taxable Income</th><th>Tax Rate</th></tr></thead><tbody>';
        
        let prevLimit = 0;
        config.rates.forEach((rate, i) => {
            const limitStr = rate.limit === Infinity ? 'and above' : formatCurrency(rate.limit);
            const fromStr = i === 0 ? '$0' : formatCurrency(prevLimit + 1);
            const rateStr = rate.rate === 0 ? 'Tax free' : (rate.rate * 100) + '%';
            html += `<tr><td>${fromStr} - ${limitStr}</td><td>${rateStr}</td></tr>`;
            prevLimit = rate.limit;
        });
        
        html += '</tbody></table>';
        
        html += '<h3>Medicare Levy</h3>';
        html += '<p>2% of taxable income for Australian residents (threshold ' + formatCurrency(config.medicareThreshold) + ' for singles)</p>';
        
        html += '<h3>HELP/HECS Repayments</h3>';
        if (config.helpRates === 'marginal') {
            html += '<ul>';
            html += '<li>Minimum threshold: ' + formatCurrency(config.helpThreshold) + '</li>';
            html += '<li>' + formatCurrency(config.helpThreshold) + ' - $125,000: 15% of amount over ' + formatCurrency(config.helpThreshold) + '</li>';
            html += '<li>$125,001 - $179,285: $8,700 + 17% of amount over $125,000</li>';
            html += '<li>$179,286+: 10% of total income</li>';
            html += '</ul>';
        } else {
            html += '<p>Minimum threshold: ' + formatCurrency(config.helpThreshold) + '</p>';
            html += '<p>Repayment rates range from 1% to 10% of total income based on income level.</p>';
        }
        html += '<p><em>Note: HELP repayments are capped at your current debt balance.</em></p>';
        
        html += '<h3>Tax Offsets</h3>';
        html += '<p><strong>LITO (Low Income Tax Offset):</strong> Up to $' + config.lito.max + ' for incomes up to $' + config.lito.threshold1.toLocaleString() + ', phasing out to zero at $' + config.lito.threshold3.toLocaleString() + '</p>';
        html += '<p><strong>SAPTO (Seniors and Pensioners):</strong> Up to $' + config.sapto.max + ' for singles, phasing out from $' + config.sapto.threshold.toLocaleString() + ' to $' + config.sapto.cutout.toLocaleString() + '</p>';
        
        infoDiv.innerHTML = html;
    }

    function toggleInfo() {
        const panel = document.getElementById('infoPanel');
        const text = document.getElementById('infoToggleText');
        if (panel.classList.contains('active')) {
            panel.classList.remove('active');
            text.textContent = 'View Tax Information';
        } else {
            updateInfoPanel();
            panel.classList.add('active');
            text.textContent = 'Hide Tax Information';
        }
    }

    function clearScenario(num) {
        // Reset income input
        const incomeEl = document.getElementById('income' + num);
        if (incomeEl) incomeEl.value = '';

        // Uncheck dividend checkbox and hide inputs
        const dividendCheck = document.getElementById('dividend' + num);
        if (dividendCheck) dividendCheck.checked = false;
        const dividendInputs = document.getElementById('dividendInputs' + num);
        if (dividendInputs) dividendInputs.classList.add('hidden');
        const dividendAmount = document.getElementById('dividendAmount' + num);
        if (dividendAmount) dividendAmount.value = '';
        const frankingCreditEl = document.getElementById('frankingCredit' + num);
        if (frankingCreditEl) frankingCreditEl.value = '';
        const totalAssessableDividend = document.getElementById('totalAssessableDividend' + num);
        if (totalAssessableDividend) totalAssessableDividend.value = '0';

        // Reset residency to resident
        const residentRadio = document.querySelector(`input[name="resident${num}"][value="resident"]`);
        if (residentRadio) residentRadio.checked = true;

        // Uncheck HELP checkbox
        const helpCheck = document.getElementById('help' + num);
        if (helpCheck) helpCheck.checked = false;

        // Clear HELP debt and disable it
        const helpDebtEl = document.getElementById('helpDebt' + num);
        if (helpDebtEl) {
            helpDebtEl.value = '';
            helpDebtEl.disabled = true;
            helpDebtEl.parentElement.classList.add('disabled');
        }

        // Uncheck PAYG Withholding checkbox
        const paygWithholdingCheck = document.getElementById('paygWithholding' + num);
        if (paygWithholdingCheck) paygWithholdingCheck.checked = false;

        // Clear PAYG Withholding amount and disable it
        const paygWithholdingEl = document.getElementById('paygWithholdingAmount' + num);
        if (paygWithholdingEl) {
            paygWithholdingEl.value = '';
            paygWithholdingEl.disabled = true;
            paygWithholdingEl.parentElement.classList.add('disabled');
        }

        // Uncheck PAYG checkbox
        const paygCheck = document.getElementById('payg' + num);
        if (paygCheck) paygCheck.checked = false;

        // Clear PAYG amount and disable it
        const paygEl = document.getElementById('paygAmount' + num);
        if (paygEl) {
            paygEl.value = '';
            paygEl.disabled = true;
            paygEl.parentElement.classList.add('disabled');
        }

        // Uncheck SAPTO checkbox
        const saptoCheck = document.getElementById('sapto' + num);
        if (saptoCheck) saptoCheck.checked = false;

        // Clear all result displays
        const resultFields = [
            'baseIncome', 'taxOnIncome', 'medicareLevy', 'helpRepayment', 
            'lito', 'frankingCreditOffset', 'paygWithholdingPaid', 'paygPaid', 'totalTax', 'netAnnual', 'netMonthly', 'netWeekly'
        ];
        
        resultFields.forEach(field => {
            const el = document.getElementById(field + num);
            if (el) el.textContent = '$0';
        });

        // Clear SAPTO amount (has different ID format)
        const saptoAmountEl = document.getElementById('sapto' + num + 'Amount');
        if (saptoAmountEl) saptoAmountEl.textContent = '$0';
        
        // Reset Total Tax label
        const totalTaxLabel = document.getElementById('totalTaxLabel' + num);
        if (totalTaxLabel) totalTaxLabel.textContent = 'Total Tax:';
        
        // Remove refund class from Total Tax row
        const totalTaxRow = document.getElementById('totalTaxRow' + num);
        if (totalTaxRow) totalTaxRow.classList.remove('refund');
    }

    window.onload = function () {
        const container = document.getElementById('scenariosContainer');
        for (let i = 1; i <= 4; i++) {
            container.innerHTML += createScenarioHTML(i);
        }
        updateGridLayout();
    };
</script>
</body>
</html>